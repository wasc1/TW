<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Tropas x Pontos (Tribal Wars)</title>
  <style>
    :root{
      --bg:#0f1216;
      --card:#161b22;
      --card2:#0f1216;
      --border:#263040;
      --border2:#2a3648;
      --text:#e9eef5;
      --muted:#9fb0c5;
      --ok:#6ee7b7;
      --bad:#fb7185;
      --link:#9cc2ff;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, #18202b 0%, var(--bg) 55%) no-repeat, var(--bg);
      color: var(--text);
    }
    .wrap{max-width:1080px;margin:0 auto;padding:22px 16px 60px;}
    header{margin-bottom:14px;}
    h1{margin:0;font-size:20px}
    .subtitle{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}
    .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;margin-top:14px;}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr;} }
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px;font-size:15px}
    .muted{color:var(--muted);font-size:12px;line-height:1.35}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0;}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin:10px 0;}
    @media (max-width: 600px){
      .row, .row3{grid-template-columns:1fr;}
    }
    label{display:block;color:var(--muted);font-size:12px;margin:0 0 6px;}
    input{
      width:100%;
      background: var(--card2);
      border:1px solid var(--border2);
      border-radius: 10px;
      padding:10px 10px;
      color: var(--text);
      outline:none;
    }
    input:focus{border-color:var(--link); box-shadow: 0 0 0 3px rgba(156,194,255,.15);}
    .check{
      display:flex;gap:8px;align-items:center;
      padding:10px;
      border:1px dashed var(--border2);
      border-radius:12px;
      background: rgba(0,0,0,.15);
    }
    .check input{width:auto}
    .kpi{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      background: rgba(0,0,0,.2);
      border: 1px dashed var(--border2);
      border-radius: 12px;
      padding: 12px;
      white-space: pre-wrap;
      word-break: break-word;
      margin-top:10px;
    }
    .ok{color:var(--ok);font-weight:900}
    .bad{color:var(--bad);font-weight:900}
    a{color:var(--link);text-decoration:none}
    a:hover{text-decoration:underline}
    details{
      margin-top:12px;
      border:1px solid var(--border2);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
    }
    summary{cursor:pointer;font-weight:800}
    .badge{
      display:inline-block;
      margin-left:8px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--border2);
      font-size:11px;
      color:var(--muted);
      vertical-align:middle;
    }
    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
      text-align:center;
    }
    .smallcode{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
    .phaseBox{
      border:1px solid var(--border2);
      border-radius:12px;
      padding:10px;
      background: rgba(0,0,0,.18);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Calculadora Tropas x Pontos — Tribal Wars</h1>
      <div class="subtitle">
        A página calcula <b>t</b> (tropas equivalentes) e compara com <b>M</b> (mínimo) definido automaticamente pela faixa de pontos:
        <span class="smallcode">até 400</span> (início), <span class="smallcode">401–1499</span> (meio), <span class="smallcode">1500+</span> (fim).
      </div>
    </header>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card">
        <h2>Entrada</h2>

        <div class="row">
          <div>
            <label>Pontos do jogador (p)</label>
            <input id="pontos" inputmode="numeric" placeholder="Ex.: 43079">
            <div class="muted">Aceita <span class="smallcode">43.079</span>, <span class="smallcode">43 079</span> ou <span class="smallcode">43079</span>.</div>
          </div>

          <div class="phaseBox">
            <div class="muted">Fase detectada</div>
            <div style="font-weight:900;font-size:13px;margin-top:4px" id="faseTxt">—</div>
            <div class="muted" style="margin-top:6px" id="regraTxt">—</div>
          </div>
        </div>

        <div class="row">
          <div class="check">
            <input id="temArqueiro" type="checkbox">
            <div>
              <div style="font-weight:800">Mundo tem arqueiros</div>
              <div class="muted">Se desligado, Aq e Ac não entram no cálculo.</div>
            </div>
          </div>
          <div class="muted" style="padding:10px;border:1px dashed var(--border2);border-radius:12px;background:rgba(0,0,0,.15)">
            Espiões normalmente <b>não entram</b> nesse cálculo (é uma métrica de volume militar).
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--border);margin:12px 0;">

        <h2>Tropas</h2>

        <div class="row3">
          <div>
            <label>Lanceiros (Lc)</label>
            <input id="Lc" inputmode="numeric" placeholder="0">
          </div>
          <div>
            <label>Espadachins (Ep)</label>
            <input id="Ep" inputmode="numeric" placeholder="0">
          </div>
          <div>
            <label>Bárbaros / Berserker (Bb)</label>
            <input id="Bb" inputmode="numeric" placeholder="0">
          </div>
        </div>

        <div class="row3">
          <div>
            <label>Cavaleiro Leve (Cl)</label>
            <input id="Cl" inputmode="numeric" placeholder="0">
          </div>
          <div>
            <label>Cavaleiro Pesado (Cp)</label>
            <input id="Cp" inputmode="numeric" placeholder="0">
          </div>
          <div>
            <label>Aríetes (Ar)</label>
            <input id="Ar" inputmode="numeric" placeholder="0">
          </div>
        </div>

        <div class="row3">
          <div>
            <label>Catapultas (Ct)</label>
            <input id="Ct" inputmode="numeric" placeholder="0">
          </div>

          <div id="wrapAq" style="display:none;">
            <label>Arqueiros (Aq)</label>
            <input id="Aq" inputmode="numeric" placeholder="0">
          </div>

          <div id="wrapAc" style="display:none;">
            <label>Arqueiros a cavalo (Ac)</label>
            <input id="Ac" inputmode="numeric" placeholder="0">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Paladinos (Pl)</label>
            <input id="Pl" inputmode="numeric" placeholder="0">
          </div>
          <div class="muted" style="padding:10px;border:1px solid var(--border2);border-radius:12px;background:rgba(0,0,0,.18)">
            <b>Pesos usados:</b> infantaria/arqueiro = 1 • CL = 4 • Ac = 5 • CP = 6 • Ar = 5 • Ct = 8 • Pl = 10
          </div>
        </div>

        <div class="muted" style="margin-top:10px">
          Resultado atualiza automaticamente conforme você digita.
        </div>
      </div>

      <!-- RESULTADOS + EXPLICAÇÃO -->
      <div class="card">
        <h2>Resultado</h2>
        <div class="muted">
          A página calcula <b>t</b> (tropas equivalentes) e compara com <b>M</b> (mínimo pela fase detectada).
        </div>

        <div class="kpi" id="out">Digite seus pontos e tropas para ver o resultado.</div>

        <details open>
          <summary>Entenda o cálculo <span class="badge">resumo</span></summary>

          <div class="muted" style="margin-top:10px">
            Fórmula usada:
          </div>

          <div class="kpi" id="formulaBox" style="margin-top:10px"></div>

          <div class="muted" style="margin-top:10px">
            A fase é definida automaticamente pelos pontos:
            <ul>
              <li><b>Início (p ≤ 400):</b> M = 1×p</li>
              <li><b>Meio (401 ≤ p ≤ 1499):</b> M = 1,5×p</li>
              <li><b>Fim (p ≥ 1500):</b> M = 2×p</li>
            </ul>
          </div>

          <div class="muted" style="margin-top:10px">
            Referência (tópico do fórum):
            <a target="_blank" rel="noreferrer"
               href="https://forum.tribalwars.com.br/index.php?threads/tropas-como-saber-a-quantidade-certa-de-tropas.128962/">
               Tropas: como saber a quantidade certa de tropas
            </a>
          </div>
        </details>

        <details>
          <summary>Transparência <span class="badge">privacidade</span></summary>
          <div class="muted" style="margin-top:10px">
            Esta página não envia dados para lugar nenhum. Tudo roda local no seu navegador.
          </div>
        </details>

      </div>
    </div>

    <footer>
      Compartilhe o link com a tribo.
    </footer>
  </div>

  <script>
    const LS_KEY = "tw_tropas_calc_pages_v3";

    function parseBRInt(v){
      if(v === null || v === undefined) return 0;
      let s = String(v).trim();
      if(!s) return 0;
      s = s.replace(/[^\d]/g,'');
      return s ? parseInt(s,10) : 0;
    }
    function fmt(n){
      try { return (n ?? 0).toLocaleString('pt-BR'); }
      catch { return String(n ?? 0); }
    }
    function ceilDiv(a,b){ return Math.ceil(a/b); }

    function loadPrefs(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return { temArqueiro:false };
        const p = JSON.parse(raw);
        return { temArqueiro: !!p.temArqueiro };
      }catch{
        return { temArqueiro:false };
      }
    }
    function savePrefs(prefs){
      localStorage.setItem(LS_KEY, JSON.stringify(prefs));
    }

    function formulaText(hasArchers){
      return hasArchers
        ? "t = Lc + Ep + Bb + Aq + (Cl×4) + (Ac×5) + (Cp×6) + (Ar×5) + (Ct×8) + (Pl×10)"
        : "t = Lc + Ep + Bb + (Cl×4) + (Cp×6) + (Ar×5) + (Ct×8) + (Pl×10)";
    }

    function phaseByPoints(p){
      if(!p || p <= 0) return { phase:"—", mult:0, label:"—" };
      if(p <= 400) return { phase:"Início", mult:1.0, label:"M = 1×p (p ≤ 400)" };
      if(p <= 1499) return { phase:"Meio", mult:1.5, label:"M = 1,5×p (401–1499)" };
      return { phase:"Fim", mult:2.0, label:"M = 2×p (p ≥ 1500)" };
    }

    function readData(){
      const temArqueiro = document.getElementById("temArqueiro").checked;
      return {
        p: parseBRInt(document.getElementById("pontos").value),
        temArqueiro,
        Lc: parseBRInt(document.getElementById("Lc").value),
        Ep: parseBRInt(document.getElementById("Ep").value),
        Bb: parseBRInt(document.getElementById("Bb").value),
        Cl: parseBRInt(document.getElementById("Cl").value),
        Cp: parseBRInt(document.getElementById("Cp").value),
        Ar: parseBRInt(document.getElementById("Ar").value),
        Ct: parseBRInt(document.getElementById("Ct").value),
        Pl: parseBRInt(document.getElementById("Pl").value),
        Aq: temArqueiro ? parseBRInt(document.getElementById("Aq").value) : 0,
        Ac: temArqueiro ? parseBRInt(document.getElementById("Ac").value) : 0
      };
    }

    function calcT(d){
      return d.Lc + d.Ep + d.Bb + (d.temArqueiro ? d.Aq : 0) +
        (d.Cl * 4) + (d.temArqueiro ? (d.Ac * 5) : 0) +
        (d.Cp * 6) + (d.Ar * 5) + (d.Ct * 8) + (d.Pl * 10);
    }

    function syncUI(){
      const tem = document.getElementById("temArqueiro").checked;
      document.getElementById("wrapAq").style.display = tem ? "" : "none";
      document.getElementById("wrapAc").style.display = tem ? "" : "none";
      document.getElementById("formulaBox").textContent = formulaText(tem);

      savePrefs({ temArqueiro: tem });
      render();
    }

    function render(){
      const d = readData();
      const out = document.getElementById("out");

      const ph = phaseByPoints(d.p);
      document.getElementById("faseTxt").textContent = ph.phase;
      document.getElementById("regraTxt").textContent = ph.label;

      if(!d.p || d.p <= 0){
        out.innerHTML = `Digite seus <span class="bad">pontos (p)</span> para calcular.`;
        return;
      }

      const t = calcT(d);
      const M = Math.round(ph.mult * d.p);
      const diff = t - M;
      const ratio = t / d.p;

      let s = "";
      s += `t = ${fmt(t)}\n`;
      s += `M = ${fmt(M)}  [${ph.phase}]\n`;
      s += `t/p = ${ratio.toFixed(2)}\n\n`;

      if(diff >= 0){
        s += `✅ OK — acima do mínimo por ${fmt(diff)} equivalentes.`;
        out.innerHTML = `<span class="ok">${s}</span>`;
      }else{
        const falta = Math.abs(diff);
        s += `❌ FALTANDO — faltam ${fmt(falta)} equivalentes.\n\n`;

        const sug = [
          `≈ ${fmt(ceilDiv(falta, 4))} CL`,
          `≈ ${fmt(ceilDiv(falta, 6))} CP`,
          `≈ ${fmt(ceilDiv(falta, 5))} Aríetes`,
          `≈ ${fmt(ceilDiv(falta, 8))} Catapultas`
        ];
        if(d.temArqueiro) sug.push(`≈ ${fmt(ceilDiv(falta, 5))} Ac`);

        s += `Equivalência (aprox.):\n- ${sug.join("\n- ")}`;
        out.innerHTML = `<span class="bad">${s}</span>`;
      }
    }

    (function init(){
      const prefs = loadPrefs();
      document.getElementById("temArqueiro").checked = prefs.temArqueiro;

      const watch = ["pontos","Lc","Ep","Bb","Cl","Cp","Ar","Ct","Pl","Aq","Ac"];
      watch.forEach(id => {
        const el = document.getElementById(id);
        if(!el) return;
        el.addEventListener("input", render);
        el.addEventListener("change", render);
      });

      document.getElementById("temArqueiro").addEventListener("change", syncUI);

      document.getElementById("formulaBox").textContent =
        formulaText(document.getElementById("temArqueiro").checked);

      syncUI();
    })();
  </script>
</body>
</html>
